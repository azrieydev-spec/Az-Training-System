{% extends "base.html" %}

{% block title %}Upload Document - KopiTiam AI Assistant{% endblock %}

{% block extra_css %}
<style>
    .upload-zone {
        border: 2px dashed #dee2e6;
        border-radius: 12px;
        padding: 60px 30px;
        text-align: center;
        background: #f8f9fa;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    .upload-zone:hover,
    .upload-zone.dragover {
        border-color: #0d6efd;
        background: #e7f1ff;
    }
    .upload-zone i {
        font-size: 4rem;
        color: #6c757d;
    }
    .upload-zone:hover i,
    .upload-zone.dragover i {
        color: #0d6efd;
    }
    .file-types {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
    }
    .file-type {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: white;
        border-radius: 20px;
        font-size: 0.875rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <h2 class="mb-4"><i class="bi bi-cloud-upload me-2"></i>Upload Training Document</h2>
            
            <div class="card">
                <div class="card-body p-4">
                    <form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data" id="uploadForm">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="upload-zone" id="uploadZone">
                            <input type="file" name="file" id="fileInput" class="d-none" 
                                   accept=".pdf,.txt,.docx" required>
                            <i class="bi bi-cloud-arrow-up"></i>
                            <h4 class="mt-3">Drag and drop your file here</h4>
                            <p class="text-muted mb-0">or click to browse</p>
                            <div class="file-types">
                                <div class="file-type">
                                    <i class="bi bi-file-earmark-pdf text-danger"></i>PDF
                                </div>
                                <div class="file-type">
                                    <i class="bi bi-file-earmark-word text-primary"></i>DOCX
                                </div>
                                <div class="file-type">
                                    <i class="bi bi-file-earmark-text text-secondary"></i>TXT
                                </div>
                            </div>
                        </div>
                        
                        <div id="filePreview" class="mt-4 d-none">
                            <div class="alert alert-info d-flex align-items-center">
                                <i class="bi bi-file-earmark-check fs-4 me-3"></i>
                                <div class="flex-grow-1">
                                    <strong id="fileName"></strong>
                                    <div class="small text-muted" id="fileSize"></div>
                                </div>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="removeFile">
                                    <i class="bi bi-x-lg"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary btn-lg w-100" id="uploadBtn" disabled>
                                <i class="bi bi-upload me-2"></i>Upload Document
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="card mt-4">
                <div class="card-body">
                    <h5><i class="bi bi-info-circle me-2"></i>Upload Guidelines</h5>
                    <ul class="mb-0 text-muted">
                        <li>Maximum file size: 16 MB</li>
                        <li>Supported formats: PDF, DOCX, TXT</li>
                        <li>Text will be extracted from documents for AI training</li>
                        <li>Uploaded documents are available to all employees</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');
const filePreview = document.getElementById('filePreview');
const fileName = document.getElementById('fileName');
const fileSize = document.getElementById('fileSize');
const uploadBtn = document.getElementById('uploadBtn');
const removeFile = document.getElementById('removeFile');

uploadZone.addEventListener('click', () => fileInput.click());

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    uploadZone.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
    });
});

['dragenter', 'dragover'].forEach(eventName => {
    uploadZone.addEventListener(eventName, () => uploadZone.classList.add('dragover'));
});

['dragleave', 'drop'].forEach(eventName => {
    uploadZone.addEventListener(eventName, () => uploadZone.classList.remove('dragover'));
});

uploadZone.addEventListener('drop', (e) => {
    const files = e.dataTransfer.files;
    if (files.length) {
        fileInput.files = files;
        handleFile(files[0]);
    }
});

fileInput.addEventListener('change', (e) => {
    if (e.target.files.length) {
        handleFile(e.target.files[0]);
    }
});

function handleFile(file) {
    const allowedTypes = ['application/pdf', 'text/plain', 
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
    const allowedExtensions = ['pdf', 'txt', 'docx'];
    const ext = file.name.split('.').pop().toLowerCase();
    
    if (!allowedExtensions.includes(ext)) {
        alert('Please upload a PDF, DOCX, or TXT file.');
        return;
    }
    
    fileName.textContent = file.name;
    fileSize.textContent = formatSize(file.size);
    filePreview.classList.remove('d-none');
    uploadBtn.disabled = false;
}

function formatSize(bytes) {
    if (bytes < 1024) return bytes + ' bytes';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

removeFile.addEventListener('click', () => {
    fileInput.value = '';
    filePreview.classList.add('d-none');
    uploadBtn.disabled = true;
});

document.getElementById('uploadForm').addEventListener('submit', () => {
    uploadBtn.disabled = true;
    uploadBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Uploading...';
});
</script>
{% endblock %}
